# PR（プルリクエスト）の書き方ガイドライン

## タイトルの書き方

### 基本ルール

- 対応するissueのタイトルに合わせる
- issueのタイトルをそのまま使うか、実装内容に合わせて微調整する
- 日本語で書く（技術用語は英語OK）

### 良い例

- `[参加可能時間] 集計パネルのカテゴリ切り替えを非同期化`
- `[テーマ投稿] 一覧に検索機能を追加`
- `[リファクタ] AvailabilitySlotsController のサービスクラス抽出`

### 避けたい例

- `Feature/65 UI improvements availability home` → 英語、ブランチ名そのまま
- `feat: ホームページに期とカテゴリで...を追加しました。` → 長すぎる、句点不要

---

## 本文の構成

### 必須セクション

#### 概要（Why）

PRの目的を1〜3行で書き、対応するissueを `Closes #XX` で明記します。

```markdown
## 概要（Why）

テーマ一覧が増加し、目的のテーマを見つけにくくなったため、
キーワード検索とカテゴリ絞り込み機能を追加する。

Closes #73
```

#### 変更内容（What）

主な変更点を箇条書きで記載します。ファイル単位ではなく**機能単位**で書きます。

```markdown
## 変更内容（What）

- テーマ一覧画面に検索フォームを追加
- `Theme` モデルに `search` スコープを実装
- Turbo Frame による検索結果の非同期更新
- 検索結果が0件の場合の空状態メッセージを追加
```

リファクタリングなど変更前後の比較が有効な場合は、Before/After表を使います。

```markdown
### Before / After

| 項目 | Before | After |
|------|--------|-------|
| Controller 行数 | 120行 | 45行 |
| ビジネスロジック | Controller に直書き | Service クラスに抽出 |
| テスタビリティ | Controller テストのみ | Service 単体テスト可能 |
```

#### 動作確認（How）

確認手順をステップで記載します。スクリーンショットやGIFがあれば添付します。

```markdown
## 動作確認（How）

1. テーマ一覧画面（`/themes`）にアクセス
2. 検索フォームにキーワードを入力し、検索ボタンをクリック
3. 該当するテーマのみ表示されることを確認
4. カテゴリプルダウンで「tech」を選択し、絞り込みを確認
5. 該当テーマが0件の場合、「テーマが見つかりませんでした」と表示されることを確認
```

### 任意セクション

#### 影響範囲

この変更が影響する画面や機能を記載します。

```markdown
## 影響範囲

- テーマ一覧画面（`/themes`）
- Theme モデル（検索スコープ追加）
- ThemesController#index（検索パラメータ対応）
```

#### 補足・レビュー時に見てほしいポイント

設計判断で迷った箇所や、代替案を検討した箇所を書きます。

```markdown
## 補足

- ransack の導入も検討したが、MVP段階ではスコープベースの実装で十分と判断した
- 将来的に全文検索が必要になった場合は pg_search 等を導入する想定
```

---

## PRのサイズ

- **1つのissueに対して1つのPR** が原則
- PRが大きくなりすぎる場合は、issueを先に分割してからPRを作成する
- 目安: 変更ファイル数が10を超える場合は分割を検討する

---

## セルフレビューチェックリスト

PR作成前に確認してください。

- [ ] Rubocop が通ること（`bundle exec rubocop`）
- [ ] 主要な動作を手動で確認した
- [ ] UI変更がある場合、daisyUI ガイドラインに沿っている
- [ ] `Closes #XX` で対応するissueを明記した
- [ ] 不要なデバッグコード（`puts`, `binding.pry` 等）を削除した

---

## Issue との関連付け

PR本文に以下のいずれかを記載すると、マージ時に自動でissueがクローズされます。

```
Closes #XX
```

- `Closes` / `Close` / `Fixes` / `Fix` いずれも使用可能
- PR本文の「概要（Why）」セクション内に記載する
