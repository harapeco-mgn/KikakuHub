<!-- Breadcrumb -->
<%= render_breadcrumbs([
  bc("ホーム", root_path),
  bc("テーマ一覧", themes_path),
  bc(@theme.title)
]) %>

<!-- Theme Detail Card -->
<div class="card bg-base-100 shadow-lg ring-1 ring-base-300">
  <div class="card-body">
    <header class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
      <div class="min-w-0 flex-1">
        <div class="mb-2 flex flex-wrap items-center gap-2">
          <span class="badge badge-primary badge-lg"><%= Theme.human_enum_name(:category, @theme.category) %></span>
          <%= render "themes/status_badge", theme: @theme %>
          <span class="text-sm text-base-content/60">
            <%= l(@theme.created_at, format: :short) %>
          </span>
        </div>
        <h1 class="text-2xl font-bold"><%= @theme.title %></h1>
      </div>
      
      <div class="flex flex-wrap items-start gap-2">
        <%= render "themes/vote_section", theme: @theme %>
        <%= render "themes/transition_buttons", theme: @theme %>
        <% if user_signed_in? && current_user == @theme.user %>
          <%= link_to "編集", edit_theme_path(@theme), class: "btn btn-ghost btn-sm" %>
          <%= button_to "削除", theme_path(@theme),
                        method: :delete,
                        data: { confirm: "本当に削除しますか？", turbo_confirm: "本当に削除しますか？" },
                        form: { class: "inline" },
                        class: "btn btn-error btn-sm" %>
        <% end %>
      </div>
    </header>

    <div class="divider"></div>

    <div class="prose max-w-none whitespace-pre-wrap leading-relaxed">
      <%= @theme.description %>
    </div>

    <%= render "themes/event_url", theme: @theme %>
  </div>
</div>

<!-- Comments & RSVP -->
<div class="card mt-6 bg-base-100 shadow-lg ring-1 ring-base-300">
  <div class="card-body">
    <h2 class="card-title">コメント</h2>

    <%= render "themes/comment_form", theme: @theme, theme_comment: @theme_comment %>

    <div class="mt-4">
      <% if @availability_supported %>
        <%= render "availability/aggregate_frame",
          url: theme_path(@theme),
          counts: @availability_counts,
          cohort: @cohort,
          category: @availability_category,
          cohort_options: @cohort_options,
          show_category_select: false
        %>
      <% else %>
        <div class="rounded-lg border border-base-300 bg-base-100 p-4">
          <h2 class="text-lg font-bold">参加可能時間（同カテゴリ集計）</h2>
          <p class="mt-1 text-sm text-base-content/60">このカテゴリは集計対象外です。</p>
        </div>
      <% end %>
    </div>

    <%= render "themes/rsvp_section", theme: @theme, rsvp: @rsvp, rsvp_counts: @rsvp_counts %>

    <!-- Comments List -->
    <%= render "themes/comments_list", theme: @theme, theme_comments: @theme_comments %>
  </div>
</div>
