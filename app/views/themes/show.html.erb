<!-- Breadcrumb -->
<div class="mb-6">
  <%= link_to "← テーマ一覧へ戻る", themes_path, class: "btn btn-ghost btn-sm gap-1 pl-0" %>
</div>

<!-- Theme Detail Card -->
<div class="card bg-base-100 shadow-lg ring-1 ring-base-300">
  <div class="card-body">
    <header class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
      <div class="min-w-0 flex-1">
        <div class="mb-2 flex flex-wrap items-center gap-2">
          <span class="badge badge-primary badge-lg"><%= @theme.category %></span>
          <span class="text-sm text-base-content/60">
            <%= l(@theme.created_at, format: :short) rescue @theme.created_at.to_s %>
          </span>
        </div>
        <h1 class="text-2xl font-bold"><%= @theme.title %></h1>
      </div>

      <div class="flex flex-wrap items-start gap-2">
        <%= render "themes/vote_section", theme: @theme %>
        <% if user_signed_in? && current_user == @theme.user %>
          <%= button_to "削除", theme_path(@theme),
                        method: :delete,
                        data: { confirm: "本当に削除しますか？", turbo_confirm: "本当に削除しますか？" },
                        form: { class: "inline" },
                        class: "btn btn-error btn-sm" %>
        <% end %>
      </div>
    </header>

    <div class="divider"></div>

    <div class="prose max-w-none whitespace-pre-wrap leading-relaxed">
      <%= @theme.description %>
    </div>
  </div>
</div>

<!-- Comments & RSVP -->
<div class="card mt-6 bg-base-100 shadow-lg ring-1 ring-base-300">
  <div class="card-body">
    <h2 class="card-title">コメント</h2>

    <%= render "themes/comment_form", theme: @theme, theme_comment: @theme_comment %>
    <% if @availability_supported %>
      <div class="mt-4">
        <%= render "availability/aggregate_panel",
          url: theme_path(@theme),
          counts: @availability_counts,
          cohort: @cohort,
          category: @availability_category,
          cohort_options: @cohort_options,
          show_category_select: false
        %>
      </div>
    <% else %>
      <div class="mt-4 rounded-lg border bg-white p-4 shadow-sm">
        <h2 class="text-lg font-bold">参加可能時間（同カテゴリ集計）</h2>
        <p class="mt-1 text-sm text-gray-600">このカテゴリは集計対象外です。</p>
      </div>
    <% end %>

    <%= render "themes/rsvp_section", theme: @theme, rsvp: @rsvp, rsvp_counts: @rsvp_counts %>

    <!-- Comments List -->
    <%= render "themes/comments_list", theme: @theme, theme_comments: @theme_comments %>
  </div>
</div>
