# CLAUDE.md

## プロジェクト概要

KikakuHub はイベント主催者が「何をやるか（テーマ）」と「いつやるか（時間帯）」を決めるための企画支援サービス。
Rails + Tailwind CSS + daisyUI で構築。Docker/WSL 環境。

## 参照ドキュメント

- UI ガイドライン: `docs/ai/ui-guidelines.ja.md`
- daisyUI リファレンス: `.github/instructions/daisyui.instructions.md`
- 開発ガイド: `CONTRIBUTING.md`
- ブランチ命名規則: `docs/contributing/branch-naming.md`
- PR ガイド: `docs/contributing/pull-request-guide.md`

---

## Obsidian ノート更新ルール

### Vault パス

```
/mnt/c/Users/toshi/OneDrive/Documents/Obsidian_Vault/obsidian/Kikakuhub/
```

### Vault 構造

- フラット構造（サブフォルダなし）
- 分類は frontmatter の `type` と `tags` で行う

### 更新トリガー

以下のタイミングで、Obsidianノートの下書きをチャット上に提示すること：

| タイミング | ノート type | 説明 |
|-----------|------------|------|
| 機能実装の完了時（PR作成時） | feature | 実装した機能の技術解説ノート |
| 設計判断・技術選定を行った時 | decision | なぜその選択をしたかの記録 |
| つまずき→解決の経験をした時 | learning | 問題と解決策、学んだことの記録 |
| リファクタリング実施時 | refactoring | 変更前後の比較と改善理由 |

### 提示方法

- ノートの下書きをチャット上にMarkdown形式で提示する
- ユーザーが内容を確認し、Vaultへ手動で保存する
- 既存ノートの更新が必要な場合は、更新箇所を明示する
- ノートのファイル名は日本語でOK（既存ノートに合わせる）

### frontmatter 規約

すべてのノートの先頭に以下のYAML frontmatterを付与する：

```yaml
---
type: feature | decision | learning | refactoring | overview
branch: feature/XX-name（該当する場合）
issue: "#XX"（該当する場合）
date: YYYY-MM-DD
tags: [関連する技術タグ]
---
```

| フィールド | 必須 | 説明 |
|-----------|------|------|
| `type` | Yes | `feature` / `decision` / `learning` / `refactoring` / `overview` |
| `date` | Yes | 作成日（YYYY-MM-DD） |
| `tags` | Yes | 関連技術タグの配列 |
| `branch` | No | 関連ブランチ名 |
| `issue` | No | 関連Issue番号 |

### ノートの必須セクション

すべてのノートに以下の4つのセクションを必ず含める。
目的: ユーザーがすべてのコードを口頭で技術的に説明できるようになること。

#### (A) 実装の思考フロー

「この機能を実装するとき、何をどの順番で考えるか」を段階的に記述する。
ルーティング → モデル → コントローラー → ビュー → サービス層 → JavaScript の順で、
各レイヤーで「何を見て何を考えるか」を具体的なファイルパスとともに記述する。

```markdown
## 実装の思考フロー

この機能を実装するために、以下の順番で考える：

1. **ルーティング**: `config/routes.rb` の該当部分を確認
   - どのHTTPメソッド・パスが必要か
   - ネストの有無
2. **モデル**: `app/models/xxx.rb` を確認
   - 必要なバリデーション・リレーション
   - スコープやクラスメソッド
3. **コントローラー**: `app/controllers/xxx_controller.rb` を確認
   - 必要なアクション
   - Strong Parameters の構成
   - before_action の必要性
4. **ビュー**: `app/views/xxx/` を確認
   - フォームの構造
   - パーシャルの分割方針
5. **サービス層**（必要な場合）: `app/services/xxx/`
   - コントローラーから抽出すべきロジック
6. **JavaScript**（必要な場合）: `app/javascript/controllers/`
   - Stimulusコントローラーの必要性
```

#### (B) 行ごとの解説

コードの各行をテーブル形式で解説する。

```markdown
## コード解説

### ファイル名
（コードブロック）

| 行 | コード | 説明 |
|----|--------|------|
| 1 | `class Xxx < ApplicationRecord` | ApplicationRecordを継承したモデルクラス |
| 2 | `belongs_to :user` | usersテーブルとの多対一のリレーション |
```

#### (C) ひとことで言うと

各技術要素を短い一文で説明する。面接で「これは何ですか？」と聞かれたときの回答。

```markdown
## ひとことで言うと

| 要素 | ひとことで言うと |
|------|-----------------|
| この機能全体 | 「〇〇を△△するための仕組み」 |
| サービスクラス | 「コントローラーから□□のロジックを切り出したもの」 |
| Turbo Frames | 「ページ全体をリロードせずに、指定した部分だけを差し替える仕組み」 |
```

#### (D) Q&A（面接・レビュー想定）

技術面接やコードレビューで聞かれそうな質問と回答を記述する。

```markdown
## Q&A

### Q: なぜこのロジックを選んだのですか？
A: ...

### Q: 変更前と比べてどう改善されましたか？
A: ...

### Q: 他の方法は検討しましたか？
A: ...

### Q: このコードのテストはどう書きますか？
A: ...
```

---

## ノートテンプレート

### 機能実装テンプレート（type: feature）

```markdown
---
type: feature
branch: feature/XX-name
issue: "#XX"
date: YYYY-MM-DD
tags: []
---

# 機能名

## 概要
何を実装したか。1〜2行で。

## ひとことで言うと

| 要素 | ひとことで言うと |
|------|-----------------|
| この機能全体 | 「...」 |
| 主要な技術要素 | 「...」 |

## 背景・動機
なぜこの機能が必要だったか。関連Issue。

## 実装の思考フロー

この機能を実装するために、以下の順番で考える：

1. **ルーティング**: `config/routes.rb`
   - ...
2. **モデル**: `app/models/xxx.rb`
   - ...
3. **コントローラー**: `app/controllers/xxx_controller.rb`
   - ...
4. **ビュー**: `app/views/xxx/`
   - ...
5. **サービス層**（該当する場合）
   - ...
6. **JavaScript/Stimulus**（該当する場合）
   - ...

## 処理の流れ
（ASCII図やmermaid図）

## 変更ファイル一覧

| ファイル | 種類 | 役割 |
|----------|------|------|
| path | 新規/修正 | 説明 |

## コード解説

### ファイル名
（コードブロック）

| 行 | コード | 説明 |
|----|--------|------|
| 1 | ... | ... |

## 学んだこと
この実装で得た知見。

## Q&A

### Q: なぜこのロジックを選んだのですか？
A: ...

### Q: 変更前と比べてどう改善されましたか？
A: ...

### Q: 他の方法は検討しましたか？
A: ...

## 関連リンク
- [[関連ノート]]
```

### 意思決定テンプレート（type: decision）

```markdown
---
type: decision
date: YYYY-MM-DD
tags: []
---

# 決定事項のタイトル

## ひとことで言うと

| 要素 | ひとことで言うと |
|------|-----------------|
| この決定 | 「...」 |

## 背景
なぜこの決定が必要だったか。

## 選択肢

| 選択肢 | メリット | デメリット |
|--------|----------|------------|
| A | ... | ... |
| B | ... | ... |

## 決定
どちらを選び、なぜそう判断したか。

## 実装への影響
この決定がコードベースに与える影響。

## Q&A

### Q: なぜこの選択をしたのですか？
A: ...

### Q: もう一方を選ばなかった理由は？
A: ...

## 関連リンク
- [[関連ノート]]
```

### 学習ログテンプレート（type: learning）

```markdown
---
type: learning
date: YYYY-MM-DD
tags: []
---

# 学んだことのタイトル

## ひとことで言うと
「...」

## きっかけ
何をしていて学びが生まれたか。

## 学んだこと
技術的な詳細。コード例があれば含める。

## コード解説（該当する場合）

| 行 | コード | 説明 |
|----|--------|------|
| 1 | ... | ... |

## Q&A

### Q: これはどういう仕組みですか？
A: ...

### Q: どこで使えますか？
A: ...

## 今後の活用
この知識をどこに活かせるか。

## 関連リンク
- [[関連ノート]]
```

### リファクタリングテンプレート（type: refactoring）

```markdown
---
type: refactoring
branch: feature/XX-name
issue: "#XX"
date: YYYY-MM-DD
tags: []
---

# リファクタリング対象

## ひとことで言うと
「...」

## 概要
何をリファクタリングしたか。

## 実装の思考フロー

このリファクタリングで考えた順番：

1. **問題の特定**: どこに問題があるか
2. **影響範囲**: 変更がどこに波及するか
3. **方針決定**: どう変えるか
4. **実装**: 変更の順番

## Before / After

### Before
（変更前のコード）

### After
（変更後のコード）

## 改善理由
なぜこの変更が必要だったか。

## 変更ファイル一覧

| ファイル | 変更内容 |
|----------|----------|
| path | 説明 |

## Q&A

### Q: なぜリファクタリングが必要だったのですか？
A: ...

### Q: 変更前のコードの問題点は何でしたか？
A: ...

### Q: この変更でテストは壊れませんでしたか？
A: ...

## 学んだこと
リファクタリングで得た知見。

## 関連リンク
- [[関連ノート]]
```
